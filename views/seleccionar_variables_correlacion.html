{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2 class="mb-4">Seleccionar variables para Correlaci贸n en la tabla {{ table_name }}</h2>

    <form method="POST" action="{{ url_for('mostrar_mapa_de_calor', table_name=table_name) }}">
        <div class="row">
            <div class="col-md-12 mb-3">
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="select-all-checkbox">
                    <label class="form-check-label" for="select-all-checkbox">
                        Seleccionar/Deseleccionar Todo
                    </label>
                </div>
            </div>
            {% for column in columns %}
                <div class="col-md-3 mb-3">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="selected_columns" value="{{ column }}" id="{{ column }}">
                        <label class="form-check-label" for="{{ column }}">
                            {{ column }}
                        </label>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="d-flex justify-content-center">
            <button type="submit" class="btn btn-lg btn-success">Correlaci贸n</button>
        </div>
    </form>
    
    <h3 class="mt-4">Registros de la tabla {{ table_name }}:</h3>

    <a href="{{ url_for('crear_registro', table_name=selected_table) }}" class="btn btn-success mb-3">Crear Registros</a>

    <table class="table table-striped table-bordered">
        <thead class="table-dark">
            <tr>
                {% for column in columns %}
                    <th>{{ column }}</th>
                {% endfor %}
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for record in records %}
                <tr>
                    <td>{{ record[0] }}</td>
                    {% for value in record[1:] %}
                        <td>{{ value }}</td>
                    {% endfor %}
                    <td>
                        <a href="/editar/{{ selected_table }}/{{ record[0] }}" class="btn btn-primary">Editar</a>
                        <a href="/eliminar/{{ selected_table }}/{{ record[0] }}" class="btn btn-danger">Eliminar</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script>
    document.getElementById('select-all-checkbox').addEventListener('change', function () {
        var checkboxes = document.getElementsByName('selected_columns');
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].checked = this.checked;
        }
    });

    // Manejar la visualizaci贸n de la selecci贸n
    var checkboxes = document.getElementsByName('selected_columns');
    for (var i = 0; i < checkboxes.length; i++) {
        checkboxes[i].addEventListener('change', function () {
            updateSelection();
        });
    }

    function updateSelection() {
        var selectedValues = [];
        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i].checked) {
                selectedValues.push(checkboxes[i].value);
            }
        }
        console.log('Seleccionados: ' + selectedValues.join(', '));
    }

</script>
{% endblock %}
